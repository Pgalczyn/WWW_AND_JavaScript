<!-- @author Stanisław Polak <polak@agh.edu.pl> -->

<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>

    <title>
        Example 1
    </title>
</head>
<body>
<div id="root">
    <!--
        Container for the component.
        React renders the specified HTML code inside the so-called container,
        i.e. the element of the website we choose.
    -->
</div>
<!-- The 'Hello' component -->
<script type="text/babel" data-type="module">
    import React,{useEffect,useState} from "https://esm.sh/react/?dev";
    import ReactDOMClient from "https://esm.sh/react-dom/client/?dev";

    const students = [
        {first_name:'Jan' , last_name:'Kowalski',
            photo:"https://www.investopedia.com/thmb/r-ykjZLW9I4RmbU-drQ3hrksqdM=/1500x0/filters:no_upscale():max_bytes(150000):strip_icc()/GettyImages-2130374028-337261d83cc5416eb5bd23f2905a44ee.jpg",
        notes:{
            Matematyka: 0,
            Polski: 0,
            Angielski:0,
            Niemiecki:0

        }},
        {first_name:'Joanna' , last_name:'Ptak', photo:"https://st.depositphotos.com/1011643/4715/i/450/depositphotos_47157715-stock-photo-college-student-looking-up.jpg",
            notes:{
                Matematyka: 0,
                Polski: 0,
                Angielski:0,
                Niemiecki:0

            }},
        {first_name:'Michał' , last_name:'Anioł',photo:"https://thumbs.dreamstime.com/b/high-school-student-29699566.jpg",
            notes:{
                Matematyka: 0,
                Polski: 0,
                Angielski:0,
                Niemiecki:0

            }},
        {first_name:'Marysia' , last_name:'Lis',photo:"https://st2.depositphotos.com/4431055/11856/i/950/depositphotos_118562150-stock-photo-young-student-girl.jpg",
            notes:{
                Matematyka: 0,
                Polski: 0,
                Angielski:0,
                Niemiecki:0

            }},
    ]

    const addToLocalStorage = () => {

            students.forEach((student) => {
                const key = (student.first_name + " " + student.last_name).toLowerCase().trim();

                if (localStorage.getItem(key) === null) {
                    localStorage.setItem(key, JSON.stringify(student));
                } else {
                    console.log(`Użytkownik ${key} już istnieje`);
                }
            });

    };


    const changeNote = (stringInput) => {
        const user = stringInput.split(" ")
        const key = (user[0] + " " + user[1]).toLowerCase().trim();

        const newUser = JSON.parse(localStorage.getItem(key));

        if (newUser) {
            newUser.notes[user[2]] = user[3]

            localStorage.setItem(key, JSON.stringify(newUser));
        }
    }

    const StudentCard = ({student}) => {

        return (
            <>
                <div className="card col-10  col-md-5 m-2 col-lg-5 col-xl-4 col-xxl-3 m-2  " >
                    <img src={student.photo} alt="Student" width="100%" />
                    <div className="card-body">
                        <h5 className="card-title">{student.first_name + " " + student.last_name}</h5>
                        <ul className="list-group list-group-flush">
                            {Object.entries(student.notes).map(([key, value]) => {
                                if (Number(value) !== 0) {
                                    return <li key={key} className="list-group-item ">{key}: {value}</li>;
                                }
                                return null
                            })}
                        </ul>
                    </div>
                </div>
            </>
        )

    }

    const App = () =>{

        const [dataLocalStorage, setDataLocalStorage] = useState([]);

        const handleLoadDataLocalStorage = () => {
            const updatedData = students.map((student) => {
                const key = (student.first_name + " " + student.last_name).toLowerCase().trim();
                return JSON.parse(localStorage.getItem(key));
            });
            setDataLocalStorage(updatedData);
        };

        useEffect(() => {

            handleLoadDataLocalStorage();

        },[])



        useEffect(() => {
            addToLocalStorage();
        },[])


        return(
            <>
                <div className="container-fluid ">
                <form action="">

                    <label htmlFor="studentInput">Wzór:<br/> Imie Nazwisko przedmiot (opcjonalnie) ocena <br/>np. Jan
                        Kowalski Matematyka 5<br/></label>
                    <input type="text" name="student" id="studentInput"/>
                    <input type="button" value="Dodaj" id="add" onClick={() =>{ changeNote(document.getElementById("studentInput").value);handleLoadDataLocalStorage();}}/>
                    <input type="button" value="Zmień" id="change" onClick={() => changeNote(document.getElementById("studentInput").value)} />
                    <input type="button" value="Wyświetl" id="show"/>

                </form>
                </div>
                <div className="container-fluid ">
                    <div className="row d-flex justify-content-center ">
                        {dataLocalStorage.map((student,index) => {
                            return <StudentCard key={index} student={student} />;
                        })}
                    </div>
                </div>


            </>
        );

    }

    const container = document.getElementById('root'); // Retrieving references per container
    const root = ReactDOMClient.createRoot(container); // Creating a React root for the given container
    root.render(<App/>);                            // Component rendering
</script>
</body>
</html>